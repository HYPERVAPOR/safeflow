### 第一阶段：奠定基础 —— 协议标准化与核心集成 (MVP - 最小可行产品)

这个阶段的目标是**验证核心理念**：即异构工具可以通过统一协议（`MCP`）被平台调用，并输出标准化的结果。这是整个平台的基石。

1.  **首要任务：定义模型上下文协议（`MCP`）**
    * **为什么是第一步？** `MCP` 是整个系统的“通用语言”。没有它，工具接入、结果融合、流程编排都无从谈起。
    * **具体做什么？**
        * **定义工具能力声明 Schema**：设计一个标准化的数据结构（如 JSON Schema），用来描述一个工具支持什么语言、是什么类型（`SAST`, `DAST`...）、需要什么输入（代码路径、URL）、输出什么格式。
        * **定义统一漏洞模型 Schema**：设计一个标准化的漏洞数据结构，包含漏洞类型、文件路径、代码行、严重等级、置信度、来源工具等字段。这是后续结果融合的关键。
        * **定义输入/输出接口规范**：明确平台如何调用工具（API 端点、命令行格式），以及工具如何将结果回传给平台。

2.  **其次：搭建工具适配器框架**
    * **为什么？** 这是实现“即插即用”的工程基础。
    * **具体做什么？** 开发一个插件式的适配器层。每个适配器负责将一个特定工具的“方言”翻译成 `MCP` 的“普通话”。初期，这个框架可以很简单，但要保证接口是基于 `MCP` 设计的。

3.  **最后：集成“探路者”工具 (Proof of Concept)**
    * **为什么？** 不要试图一次性集成所有 8-10 款工具。选择每一类中最具代表性、最容易集成的一款来打通全流程，可以最快地验证你的架构。
    * **建议选择**：
        * **SAST**: **Semgrep**。它基于规则，命令行友好，输出是结构化的 JSON，非常适合作为第一个集成的静态分析工具。
        * **SCA**: **Dependency-Check** 或 **Syft**。两者都是成熟的开源工具，能快速对项目依赖进行扫描。
    * **目标**：成功运行一个包含 Semgrep 和 Syft 的最简流程，它们的扫描结果能被成功转换为统一漏洞模型，并存入数据库。

**这个阶段完成的标志是：** 平台能够通过 `MCP` 协议，以标准化的方式调用至少两款不同类型的工具，并获得格式统一的扫描结果。

---

### 第二阶段：构建核心 —— 编排调度与结果融合

在工具能够被统一调用的基础上，这个阶段的目标是**实现多工具的协同工作**，并提供初步的价值——整合与去重。

1.  **实现场景驱动的编排引擎**
    * **技术选型**：如文档所述，使用 **LangGraph** 或类似的框架构建有状态的工作流引擎。
    * **具体做什么？**
        * 实现第一个编排模板：“代码提交后的快速回归”。这个流程很简单：`代码拉取 -> SCA扫描 -> SAST扫描 -> 结果初步融合`。
        * 实现断点续跑和失败重试机制，这是保证流程稳定性的关键。

2.  **开发结果语义融合模块**
    * **具体做什么？**
        * **聚合与去重**：根据统一漏洞模型中的文件路径、代码行、漏洞类型等关键信息，对来自不同工具的结果进行聚合。例如，如果 Semgrep 和 SonarQube 都在同一行报告了同一个 SQL 注入问题，系统应将其合并为一条，并注明来源。
        * **优先级排序**：实现一个初步的排序算法，例如，将多个工具都报告的漏洞、或严重等级为“高危”的漏洞排在前面。

**这个阶段完成的标志是：** 用户可以触发一个预设的编排流程，平台能自动调用多个工具，并将结果进行融合与排序后呈现出来，初步解决了“工具孤岛”和“告警轰炸”的问题。

---

### 第三阶段及以后：注入智能与实现闭环

当平台具备了坚实的集成和编排能力后，再逐步引入更高级的智能化和可信化功能。

* **智能化测试用例扩展**：集成大模型，针对高优先级的漏洞，尝试自动生成能够触发它的测试用例。
* **自动化验证与差异分析**：搭建沙箱环境，自动执行生成的测试用例，通过对比程序行为来验证漏洞的真实性。
* **全流程证据链生成**：在编排引擎的每个步骤中嵌入日志和签名生成逻辑，将所有操作记录下来，形成不可篡改的证据链。

### 总结建议

从 **定义`MCP`协议** 开始，这是整个项目的技术基石和灵魂。然后，以 **集成一两个核心工具** 作为切入点，快速搭建起一个能跑通的最小原型（MVP）。在这个骨架之上，再逐步添加 **流程编排、结果融合、智能分析、可信记录** 等血肉，最终构建成一个功能完备的 `SafeFlow` 平台。