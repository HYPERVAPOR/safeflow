# 产品需求文档 (PRD)：基于 LLM Agent 的智能测试平台接入系统

| 版本号 | V1.0 (总体方案版) | 密级 | 内部 |
| :--- | :--- | :--- | :--- |
| 产品名称 | 智能一体化嵌入集成框架 (LLM Agent Based Integrated Testing System) |
| 目标用户 | 软件测试工程师、安全审计人员、DevOps/CI/CD 运维人员 |

---

## 1. 产品概述与目标 (Vision & Goals)

### 1.1 产品愿景

构建一个根据不同测试任务需求、可进行任意工具嵌入的技术和框架，提供一个智能、高效、灵活、实用的软件测试平台嵌入集成智能一体化系统，为软件测试的智能化、信息化、自动化提供可演化的技术。

### 1.2 核心目标 (Slogan: 智能接入、操作融合、信息统一、持续发展)

1.  **解决工具接入效率问题：** 打破平台封闭性，通过 Agent 机制实现外部测试工具的无缝接入和自动适配，将接入周期从数月缩短至数天。
2.  **解决数据孤岛问题：** 解决新老测试工具的测试结果不能共享、无法融合的问题。通过标准化和融合技术，构建跨工具、跨模型、跨流程的结果融合体系。
3.  **实现智能化流程编排：** 利用大语言模型（LLM）和 LangGraph，实现从自然语言指令到测试链路、工具执行的完整链条，具备任务自适应编排能力。

---

## 2. 核心功能模块 (Core Functional Modules)

系统设计采用五层架构（图 1 所示），功能分解为以下五个主要的软件配置项：

### 2.1 工具嵌入软件配置项 (Tool Embedding)

**目标：** 实现各类异构测试工具的标准化嵌入与统一生命周期管理 。

| 功能点 | 描述 | 技术要点 | 职责人 |
| :--- | :--- | :--- | :--- |
| **工具注册与能力声明** | 允许工具管理员通过 API 或界面提交新工具的注册信息，校验后生成唯一的 `tool_id` 。 | 遵循 **MCP** 协议，定义工具能力声明 (`Cap(T)`)、输入 (`I(T)`)、输出 (`O(T)`) 结构 。 | 工具管理员/开发 |
| **工具能力画像库** | 存储每个工具的能力边界、功能标签、输入输出规范等结构化描述信息，用于调度中心决策 。 | 工具封装层、标准化 JSON 结构 。 | 平台核心 |
| **Agent 生命周期管理** | 负责被纳管工具 Agent 的生命周期管理，执行相应的部署和管理操作，同时管理工具实例的资源分配和隔离 。 | 调度中心、任务状态机 。 | 平台核心 |

### 2.2 调用执行软件配置项 (Call & Execution)

**目标：** 平台的运行核心与指挥中心，负责将测试需求转化为对底层工具的具体调用 。

| 功能点 | 描述 | 技术要点 | 职责人 |
| :--- | :--- | :--- | :--- |
| **LangGraph 编排调度** | 将复杂测试任务分解为一系列有序的可执行原子步骤，管理任务步骤间的依赖关系，实现任务的动态调度和工具调用 。 | **LangGraph** 图模型，**Agent** 节点负责任务执行和结果处理 。 | 平台核心 |
| **MCP 统一调度中心** | 负责协议指令的分发、执行状态的监控及异常情况的重试与降级处理 。 | 协议解析引擎、状态监控组件 。 | 平台核心 |
| **并行任务管理** | 支持将任务拆分为多个子任务并分配给不同的 Agent 节点独立运行，提高测试效率 。 | LangGraph 的 Parallel 节点 。 | 平台核心 |

### 2.3 结果融合软件配置项 (Result Fusion)

**目标：** 将来自不同工具、格式各异的检测结果进行标准化、整合与深度处理，生成统一、可信、无冗余的融合结果集 。

| 功能点 | 描述 | 技术要点 | 职责人 |
| :--- | :--- | :--- | :--- |
| **语义解析与标准化** | 对不同工具报告中的字段进行语义层面的映射、单位统一和字段补全，转化为标准化 JSON 结构。 | 提示词工程、MCP 统一数据格式 。 | 平台核心 |
| **分层融合** | 基于“数据标准化-决策融合”逻辑，对不同工具的输出结果进行统一建模和深度处理 。 | 漏洞语义模型 (漏洞类型、文件路径、严重度、置信度等) 。 | 平台核心 |
| **数据存储** | 实现结构化数据 (元数据) 和非结构化数据 (原始日志、报告全文) 的高效存储 。 | **MySQL + MongoDB** 融合架构 。 | 平台核心 |

### 2.4 集成接入软件配置项 (Integration & Extension)

**目标：** 打通平台与外部生态系统（CI/CD、缺陷跟踪系统等）的数据流与控制流 。

| 功能点 | 描述 | 技术要点 | 职责人 |
| :--- | :--- | :--- | :--- |
| **自动化验证** | 对静态分析发现的潜在漏洞等进行自动化验证，通过动态生成并执行针对性验证脚本或 PoC (Proof of Concept) 来降低误报率。 | 与调用执行软件配置项联动 。 | 平台核心 |
| **CI/CD Webhook 触发** | 提供标准化的 Webhook 接口，接收来自 CI/CD 系统的事件，根据模板自动创建和执行测试任务 。 | `CiWebhookTrigger` 接口 (`POST /api/v1/integrations/ci/webhook/{template_id}`) 。 | 外部集成 |
| **测试用例扩展** | 允许高级用户或安全专家根据新威胁情报或业务需求，定制和扩展测试规则 。 | 自定义规则/模板管理 。 | 高级用户/安全专家 |

---

## 3. 关键技术与约束 (Technical Constraints)

| 领域 | 关键技术 | 描述 |
| :--- | :--- | :--- |
| **接入协议** | **MCP (Model Context Protocol)** | 定义标准化的接口和数据格式，实现不同安全工具的"协议化封装"，解决工具接口碎片化问题。 |
| **流程编排** | **LangGraph** | 基于大语言模型的流程编排能力，将自然语言指令转化为可执行的测试链路，支持 Agent 与工具调用的可视化管理 。 |
| **智能化** | **LLM Agent 技术** | 实现任务的自主执行与动态协同，破解传统测试平台“流程固化、响应被动”的瓶颈 。 |
| **数据存储** | **双数据库融合** | **MySQL** 存储结构化数据 (元数据)，**MongoDB** 存储非结构化/半结构化数据 (原始报告、模型输出) 。 |
| **合规性** | **军用标准** | 编制和研制过程遵循国家军用标准《GJB 438C-2021军用软件开发文档通用要求》 。 |

---

## 4. 关键数据结构与接口 (Interfaces & APIs)

### 4.1 关键数据结构 (Key Data Structures)

* **工具注册信息结构 (`ToolRegistration`):** 用于注册新工具，包含工具元数据、部署方式、支持命令等 。
* **测试任务结构 (`TestTask`):** 包含任务名称 (`task_name`)、目标 (`target`)、执行计划 (`execution_plan`) 等核心字段 。
* **原始测试结果结构 (`OriginalTestResult`):** 不同工具输出的原始数据结构 。
* **融合问题结构 (`FusionProblem`):** 经过标准化和融合后的统一漏洞语义模型 。

### 4.2 主要对外接口 (Major APIs)

平台通过 **API 网关**对外暴露 RESTful API，所有接口均使用 **JWT** 进行认证和授权 。

| 接口名称 | 路径与调用方式 | 功能描述 |
| :--- | :--- | :--- |
| **RegisterTool** | `POST /api/v1/tools` | 允许管理员注册一个新的测试工具到平台 。 |
| **CreateAndRunTask** | `POST /api/v1/tasks` | 创建一个新的测试任务并立即开始执行 。 |
| **GetTaskResults** | `GET /api/v1/tasks/{task_id}/results` | 查询指定测试任务的最终融合问题列表 。 |
| **CiWebhookTrigger** | `POST /api/v1/integrations/ci/webhook/{template_id}` | 接收来自 CI/CD 系统的事件，并根据模板自动创建和执行测试任务 。 |

## 5. 用户体验与界面需求 (UX/UI Requirements)

为了遵循现代 SaaS 产品（如 Notion/Supabase 风格）的设计原则，本平台的前端界面需满足以下要求：

### 5.1 整体布局与导航

| 元素 | 需求描述 | 样式参考 |
| :--- | :--- | :--- |
| **主布局** | 采用三明治布局：左侧可折叠导航栏 + 主内容区 + 右侧可选信息抽屉。 | Notion 或 Supabase Dashboard 风格。 |
| **侧边栏 (Navigation)** | 紧凑且支持层级折叠。主要导航项包括：**任务管理、工具仓库、结果融合、集成配置、系统设置。** | 最小宽度 240px，支持拖动调整宽度。 |
| **快速访问** | 提供全局搜索功能（`Ctrl/Cmd + K`），用于快速查找任务、工具或配置。 | 快速响应的模糊搜索模态框。 |
| **信息密度** | 在表格和列表视图中，默认采用紧凑模式，确保关键信息一目了然。 | 间距采用 4/8px 网格系统。 |

### 5.2 核心模块 UI 需求

#### A. 任务管理界面 (Task Management)

1.  **任务创建：** 提供简洁的模态框，用户可选择目标系统、输入自然语言任务描述（例如：“对这个代码库进行模糊测试和依赖分析”），LLM 自动生成 LangGraph 计划预览。
2.  **任务列表：** 采用表格视图，显示任务 ID、目标、当前状态（等待、运行中、成功、失败）、进度条及创建时间。
3.  **任务详情：**
    * **流程图可视化：** 动态显示 LangGraph 流程图，实时高亮当前正在执行的 Agent 节点，展示工具调用的输入/输出日志。
    * **结果摘要：** 突出显示融合后的关键指标（如发现问题数量、误报率、运行时间）。

#### B. 工具仓库 (Tool Repository)

1.  **工具卡片：** 每个注册工具以卡片形式展示，包含工具名称、Logo、能力描述（来自 Cap(T)）、状态（已启用/已禁用）。
2.  **注册流程：** 提供向导式（Wizard）注册界面，引导管理员声明工具能力、定义输入输出参数，自动生成 MCP 模板。

#### C. 结果融合 (Result Fusion View)

1.  **问题列表：** 仅展示经过语义融合后的**唯一**问题列表。包含：问题名称、严重度、置信度、首次发现工具、状态（待确认/已修复）。
2.  **问题详情抽屉：**
    * **融合依据：** 明确列出发现该问题的**所有原始工具报告**的引用链接或摘要，并说明融合决策的逻辑。
    * **自动化验证结果：** 展示自动验证脚本的执行日志和验证状态（验证成功/失败）。

## 6. 性能与可演化性 (Performance & Scalability)

| 方面 | 需求描述 | 优先级 |
| :--- | :--- | :--- |
| **性能指标 (Latency)** | Agent 调度决策到工具执行指令发出的延迟应在 **200ms** 以内。 | P1 (核心) |
| **并发支持** | 平台需支持至少 **100 个**并发测试任务的稳定运行。 | P1 (核心) |
| **可扩展性 (Scalability)** | 工具嵌入框架应是完全解耦的，增加或移除一个工具Agent，不应对其他组件产生任何影响。 | P1 (架构) |
| **可演化性 (Evolvability)** | 允许在不修改 Agent 核心逻辑的前提下，通过更新 **LLM 模型**或 **Prompt 模板**来优化调度和融合决策能力。 | P2 |

## 7. 安全与合规性 (Security & Compliance)

| 方面 | 需求描述 | 约束/标准 |
| :--- | :--- | :--- |
| **数据安全** | 所有敏感数据（如源代码路径、测试结果）的传输和存储必须进行加密。 | AES-256 加密。 |
| **权限管理** | 严格的 RBAC（基于角色的访问控制），区分管理员、工具管理员、普通用户权限。 | 仅限授权用户访问任务日志和工具配置。 |
| **隔离性** | 工具 Agent 的执行环境必须与平台核心系统和数据库环境进行严格隔离（容器化/沙箱）。 | Docker/Kubernetes 隔离。 |
| **文档合规** | 所有项目文档、设计和研发过程需满足军用软件标准。 | GJB 438C-2021 |

---

## 8. 验收标准 (Acceptance Criteria)

| 编号 | 验收项 | 关键指标 | 优先级 |
| :--- | :--- | :--- | :--- |
| AC-1 | **异构工具接入** | 成功接入 **3 种**或以上类型完全不同的测试工具 (如静态分析、依赖分析、动态测试)。 | P1 |
| AC-2 | **自然语言调度** | 用户输入测试目标后，LLM Agent 能够自动生成正确的 LangGraph 调度图，并成功执行任务。 | P1 |
| AC-3 | **结果融合有效性** | 对同一目标使用两种以上工具测试后，融合结果中的**冗余问题数量**相比原始报告总和**减少 40%** 以上。 | P1 |
| AC-4 | **MCP 协议兼容性** | 任何新工具的封装和注册，仅通过遵循 MCP 协议的配置，无需修改核心平台代码。 | P1 |
| AC-5 | **性能达标** | 满负荷并发任务状态下，系统运行无崩溃，调度延迟满足 200ms 要求。 | P1 |

---

## 9. 研制进度与资源 (Timeline & Resources)

根据总体方案（第 10 章节），将研发流程分解为阶段。

| 阶段 | 周期 | 核心任务 | 交付物 | 职责人 |
| :--- | :--- | :--- | :--- | :--- |
| **阶段 1：架构设计与环境搭建** | 3 个月 | 确定 MCP 协议细节、搭建 LangGraph 调度中心原型、基础 UI/UX 设计。 | 核心架构文档、MCP 协议规范 V1.0。 | 架构师/核心开发 |
| **阶段 2：功能实现与单元测试** | 4 个月 | 完成工具嵌入、调用执行、基础结果融合模块开发。 | 集成测试报告、Agent 核心功能代码 V1.0。 | 开发团队 |
| **阶段 3：系统集成与测试** | 5 个月 | 完成结果融合的深度处理、CI/CD 集成、系统级性能优化。 | 最终产品代码 V1.0、用户操作手册。 | 测试团队 |
| **总周期** | **12 个月** | 达成所有验收标准，完成系统交付。 | | |